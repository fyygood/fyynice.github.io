<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¥­æ­ªæ­ª - æ€è€ƒ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <img src="images/image1.jpg" alt="å¤´åƒ" class="header-avatar">
            <h1>é¥­æ­ªæ­ª</h1>
            <span class="house-icon">ğŸ </span>
        </div>
        <nav class="header-nav">
            <a href="index.html" class="nav-item">é¦–é¡µ</a>
            <a href="log.html" class="nav-item">æ—¥å¿—</a>
            <a href="todo.html" class="nav-item">to do</a>
            <a href="growth.html" class="nav-item">æˆé•¿</a>
            <a href="thought.html" class="nav-item active">æ€è€ƒ</a>
        </nav>
    </header>

    <main class="thought-main">
        <aside class="thought-sidebar">
            <div class="title-list" id="title-list">
                <!-- æ ‡é¢˜åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </aside>
        <div class="thought-content">
            <div class="markdown-container" id="markdown-content">
                <p>markdown æ–‡ä»¶</p>
            </div>
        </div>
    </main>

    <script src="js/marked.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        // æ£€æµ‹å¹¶ç”Ÿæˆæ ‡é¢˜åˆ—è¡¨ï¼ˆåªæ˜¾ç¤ºå­˜åœ¨çš„æ–‡ä»¶ï¼‰
        async function generateTitleList() {
            const titleList = document.getElementById('title-list');
            const maxFiles = 50; // æœ€å¤šæ£€æµ‹50ä¸ªæ–‡ä»¶
            const existingFiles = [];
            let firstFileLoaded = false;
            
            // å¿«é€Ÿæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆä½¿ç”¨HEADè¯·æ±‚ï¼Œæ›´è½»é‡ï¼‰
            async function quickCheckFile(index) {
                const path = `markdown/thought/${index}.md`;
                try {
                    const response = await fetch(path, { method: 'HEAD' });
                    return response.ok;
                } catch (error) {
                    return false;
                }
            }
            
            // è·å–æ–‡ä»¶å†…å®¹å’Œæ ‡é¢˜
            async function getFileInfo(index) {
                const path = `markdown/thought/${index}.md`;
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        const text = await response.text();
                        // æå–ç¬¬ä¸€è¡Œä½œä¸ºæ ‡é¢˜ï¼ˆå»é™¤ # å’Œç©ºæ ¼ï¼‰
                        const firstLine = text.split('\n')[0].trim();
                        let title = firstLine.startsWith('#') 
                            ? firstLine.substring(1).trim() 
                            : firstLine;
                        // å¦‚æœæ ‡é¢˜ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤æ ‡é¢˜
                        if (!title || title.length === 0) {
                            title = `æ€è€ƒ${index}`;
                        }
                        return { index, title, path };
                    }
                } catch (error) {
                    // æ–‡ä»¶ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥
                }
                return null;
            }
            
            // åˆ›å»ºæ ‡é¢˜åˆ—è¡¨é¡¹
            function createTitleItem({ index, title, path }) {
                const titleItem = document.createElement('div');
                titleItem.className = 'title-item';
                titleItem.textContent = title;
                titleItem.setAttribute('data-path', path);
                titleItem.setAttribute('data-index', index);
                
                titleItem.addEventListener('click', function() {
                    // ç§»é™¤ä¹‹å‰çš„æ¿€æ´»çŠ¶æ€
                    document.querySelectorAll('.title-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // æ·»åŠ å½“å‰æ¿€æ´»çŠ¶æ€
                    this.classList.add('active');
                    
                    // åŠ è½½ Markdown æ–‡ä»¶
                    const filePath = this.getAttribute('data-path');
                    loadMarkdown(filePath);
                });
                
                titleList.appendChild(titleItem);
                return titleItem;
            }
            
            // ä¼˜å…ˆå¿«é€Ÿæ£€æµ‹å‰10ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå°±ç«‹å³åŠ è½½
            for (let i = 1; i <= 10 && !firstFileLoaded; i++) {
                const exists = await quickCheckFile(i);
                if (exists) {
                    const fileInfo = await getFileInfo(i);
                    if (fileInfo) {
                        existingFiles.push(fileInfo);
                        const firstItem = createTitleItem(fileInfo);
                        firstItem.classList.add('active');
                        loadMarkdown(fileInfo.path);
                        firstFileLoaded = true;
                        break; // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°±åœæ­¢
                    }
                }
            }
            
            // å¦‚æœå‰10ä¸ªéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œç»§ç»­æ£€æµ‹æ›´å¤šæ–‡ä»¶ï¼ˆä½†åªæ£€æµ‹åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ºæ­¢ï¼‰
            if (!firstFileLoaded) {
                for (let i = 11; i <= maxFiles && !firstFileLoaded; i++) {
                    const exists = await quickCheckFile(i);
                    if (exists) {
                        const fileInfo = await getFileInfo(i);
                        if (fileInfo) {
                            existingFiles.push(fileInfo);
                            const firstItem = createTitleItem(fileInfo);
                            firstItem.classList.add('active');
                            loadMarkdown(fileInfo.path);
                            firstFileLoaded = true;
                            break;
                        }
                    }
                }
            }
            
            // å¦‚æœæ²¡æœ‰ä»»ä½•æ–‡ä»¶ï¼Œæ˜¾ç¤ºæç¤º
            if (existingFiles.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'title-item';
                emptyMsg.textContent = 'æš‚æ— æ€è€ƒæ–‡ç« ';
                emptyMsg.style.color = '#999';
                emptyMsg.style.cursor = 'default';
                titleList.appendChild(emptyMsg);
                return;
            }
            
            // æŒ‰ç´¢å¼•ä»å°åˆ°å¤§æ’åºèœå•é¡¹
            const items = Array.from(titleList.querySelectorAll('.title-item'));
            items.sort((a, b) => {
                const indexA = parseInt(a.getAttribute('data-index'));
                const indexB = parseInt(b.getAttribute('data-index'));
                return indexA - indexB;
            });
            titleList.innerHTML = '';
            items.forEach(item => titleList.appendChild(item));
            
            // ç¡®ä¿ç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯æ¿€æ´»çŠ¶æ€
            if (items.length > 0) {
                const firstItem = items[0];
                if (!firstItem.classList.contains('active')) {
                    firstItem.classList.add('active');
                    loadMarkdown(firstItem.getAttribute('data-path'));
                }
            }
            
            // å¼‚æ­¥æ£€æµ‹å‰©ä½™æ–‡ä»¶ï¼ˆä¸é˜»å¡åˆå§‹æ˜¾ç¤ºï¼‰
            setTimeout(async () => {
                const checkedIndices = new Set(existingFiles.map(f => f.index));
                
                for (let i = 1; i <= maxFiles; i++) {
                    // è·³è¿‡å·²ç»æ£€æµ‹è¿‡çš„æ–‡ä»¶
                    if (checkedIndices.has(i)) continue;
                    
                    const exists = await quickCheckFile(i);
                    if (exists) {
                        const fileInfo = await getFileInfo(i);
                        if (fileInfo) {
                            existingFiles.push(fileInfo);
                            createTitleItem(fileInfo);
                            checkedIndices.add(i);
                            
                            // é‡æ–°æ’åºèœå•é¡¹
                            const allItems = Array.from(titleList.querySelectorAll('.title-item'));
                            allItems.sort((a, b) => {
                                const indexA = parseInt(a.getAttribute('data-index'));
                                const indexB = parseInt(b.getAttribute('data-index'));
                                return indexA - indexB;
                            });
                            titleList.innerHTML = '';
                            allItems.forEach(item => titleList.appendChild(item));
                            
                            // ä¿æŒç¬¬ä¸€ä¸ªæ–‡ä»¶çš„æ¿€æ´»çŠ¶æ€
                            if (allItems.length > 0 && !allItems[0].classList.contains('active')) {
                                document.querySelectorAll('.title-item').forEach(item => {
                                    item.classList.remove('active');
                                });
                                allItems[0].classList.add('active');
                            }
                        }
                    }
                }
            }, 100);
        }
        
        function loadMarkdown(path) {
            fetch(path)
                .then(response => {
                    if (!response.ok) throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');
                    return response.text();
                })
                .then(text => {
                    document.getElementById('markdown-content').innerHTML = marked.parse(text);
                })
                .catch(error => {
                    document.getElementById('markdown-content').innerHTML = '<p>markdown æ–‡ä»¶</p>';
                });
        }
        
        generateTitleList();
    </script>
</body>
</html>

