<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¥­æ­ªæ­ª - æ€è€ƒ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <img src="images/image1.jpg" alt="å¤´åƒ" class="header-avatar">
            <h1>é¥­æ­ªæ­ª</h1>
            <span class="house-icon">ğŸ </span>
        </div>
        <nav class="header-nav">
            <a href="index.html" class="nav-item">é¦–é¡µ</a>
            <a href="log.html" class="nav-item">æ—¥å¿—</a>
            <a href="todo.html" class="nav-item">to do</a>
            <a href="growth.html" class="nav-item">æˆé•¿</a>
            <a href="thought.html" class="nav-item active">æ€è€ƒ</a>
        </nav>
    </header>

    <main class="thought-main">
        <aside class="thought-sidebar">
            <div class="title-list" id="title-list">
                <!-- æ ‡é¢˜åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </aside>
        <div class="thought-content">
            <div class="markdown-container" id="markdown-content">
                <p>markdown æ–‡ä»¶</p>
            </div>
        </div>
    </main>

    <script src="js/marked.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        // æ£€æµ‹å¹¶ç”Ÿæˆæ ‡é¢˜åˆ—è¡¨ï¼ˆåªæ˜¾ç¤ºå­˜åœ¨çš„æ–‡ä»¶ï¼‰
        async function generateTitleList() {
            const titleList = document.getElementById('title-list');
            const maxFiles = 50; // æœ€å¤šæ£€æµ‹50ä¸ªæ–‡ä»¶
            const existingFiles = [];
            
            // æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶è·å–æ ‡é¢˜
            async function checkFileExists(index) {
                const path = `markdown/thought/${index}.md`;
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        const text = await response.text();
                        // æå–ç¬¬ä¸€è¡Œä½œä¸ºæ ‡é¢˜ï¼ˆå»é™¤ # å’Œç©ºæ ¼ï¼‰
                        const firstLine = text.split('\n')[0].trim();
                        let title = firstLine.startsWith('#') 
                            ? firstLine.substring(1).trim() 
                            : firstLine;
                        // å¦‚æœæ ‡é¢˜ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤æ ‡é¢˜
                        if (!title || title.length === 0) {
                            title = `æ€è€ƒ${index}`;
                        }
                        return { index, title, path };
                    }
                } catch (error) {
                    // æ–‡ä»¶ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥
                }
                return null;
            }
            
            // å¹¶è¡Œæ£€æµ‹æ‰€æœ‰æ–‡ä»¶
            const checkPromises = [];
            for (let i = 1; i <= maxFiles; i++) {
                checkPromises.push(checkFileExists(i));
            }
            
            const results = await Promise.all(checkPromises);
            
            // è¿‡æ»¤å‡ºå­˜åœ¨çš„æ–‡ä»¶
            results.forEach(result => {
                if (result) {
                    existingFiles.push(result);
                }
            });
            
            // å¦‚æœæ²¡æœ‰ä»»ä½•æ–‡ä»¶ï¼Œæ˜¾ç¤ºæç¤º
            if (existingFiles.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'title-item';
                emptyMsg.textContent = 'æš‚æ— æ€è€ƒæ–‡ç« ';
                emptyMsg.style.color = '#999';
                emptyMsg.style.cursor = 'default';
                titleList.appendChild(emptyMsg);
                return;
            }
            
            // åˆ›å»ºæ ‡é¢˜åˆ—è¡¨é¡¹
            existingFiles.forEach(({ index, title, path }) => {
                const titleItem = document.createElement('div');
                titleItem.className = 'title-item';
                titleItem.textContent = title;
                titleItem.setAttribute('data-path', path);
                titleItem.setAttribute('data-index', index);
                
                titleItem.addEventListener('click', function() {
                    // ç§»é™¤ä¹‹å‰çš„æ¿€æ´»çŠ¶æ€
                    document.querySelectorAll('.title-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // æ·»åŠ å½“å‰æ¿€æ´»çŠ¶æ€
                    this.classList.add('active');
                    
                    // åŠ è½½ Markdown æ–‡ä»¶
                    const filePath = this.getAttribute('data-path');
                    loadMarkdown(filePath);
                });
                
                titleList.appendChild(titleItem);
            });
        }
        
        function loadMarkdown(path) {
            fetch(path)
                .then(response => {
                    if (!response.ok) throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');
                    return response.text();
                })
                .then(text => {
                    document.getElementById('markdown-content').innerHTML = marked.parse(text);
                })
                .catch(error => {
                    document.getElementById('markdown-content').innerHTML = '<p>markdown æ–‡ä»¶</p>';
                });
        }
        
        generateTitleList();
    </script>
</body>
</html>

