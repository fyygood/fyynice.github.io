<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¥­æ­ªæ­ª - æ€è€ƒ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <img src="images/image1.jpg" alt="å¤´åƒ" class="header-avatar">
            <h1>é¥­æ­ªæ­ª</h1>
            <span class="house-icon">ğŸ </span>
        </div>
        <nav class="header-nav">
            <a href="index.html" class="nav-item">é¦–é¡µ</a>
            <a href="log.html" class="nav-item">æ—¥å¿—</a>
            <a href="todo.html" class="nav-item">to do</a>
            <a href="growth.html" class="nav-item">æˆé•¿</a>
            <a href="thought.html" class="nav-item active">æ€è€ƒ</a>
        </nav>
    </header>

    <main class="thought-main">
        <aside class="thought-sidebar">
            <div class="title-list" id="title-list">
                <!-- æ ‡é¢˜åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </aside>
        <div class="thought-content">
            <div class="markdown-container" id="markdown-content">
            </div>
        </div>
    </main>

    <script src="js/marked.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        // æ£€æµ‹å¹¶ç”Ÿæˆæ ‡é¢˜åˆ—è¡¨ï¼ˆåªæ˜¾ç¤ºå­˜åœ¨çš„æ–‡ä»¶ï¼ŒæŒ‰ä¿®æ”¹æ—¶é—´æ’åºï¼‰
        async function generateTitleList() {
            const titleList = document.getElementById('title-list');
            const existingFiles = [];
            let firstFileLoaded = false;
            
            // å®šä¹‰æ‰€æœ‰å¯èƒ½çš„æ–‡ä»¶ååˆ—è¡¨ï¼ˆç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ–°çš„æ–‡ä»¶åï¼‰
            // æ–‡ä»¶ååº”è¯¥æ˜¯æœ‰æ„ä¹‰çš„åç§°ï¼Œä¾‹å¦‚ï¼šå…³äºç”Ÿæ´».mdã€å…³äºæˆé•¿.md ç­‰
            // æ³¨æ„ï¼šæ–‡ä»¶åä¸éœ€è¦åŒ…å« .md æ‰©å±•å
            const possibleFiles = [
                'AIåº”ç”¨',
                'æ—…è¡Œweb+appç«¯',
                'é…’é¦†æƒ³æ³•',
                'å¥³æ€§ä¸»ä¹‰æ€è€ƒ',
                'æœ«ä¸–æ–‡æƒ³æ³•',
                'AIåˆ†èº«',
                'å­¦ä¹ ç¬”è®°',
                'è½¦å­åˆ†æ',
                'é«˜ä¸­æ•°å­¦æ•™å­¦'
                // ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œç»§ç»­æ·»åŠ æ›´å¤šæ–‡ä»¶å
            ];
            
            // å¿«é€Ÿæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶è·å–ä¿®æ”¹æ—¶é—´
            async function checkFile(filename) {
                const path = `markdown/thought/${filename}.md`;
                try {
                    const response = await fetch(path, { method: 'HEAD' });
                    if (response.ok) {
                        // è·å–æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´
                        const lastModified = response.headers.get('Last-Modified');
                        const modifiedTime = lastModified ? new Date(lastModified).getTime() : Date.now();
                        return { exists: true, modifiedTime, path };
                    }
                } catch (error) {
                    // æ–‡ä»¶ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥
                }
                return { exists: false };
            }
            
            // è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ ‡é¢˜å’Œä¿®æ”¹æ—¶é—´ï¼‰
            async function getFileInfo(filename) {
                const path = `markdown/thought/${filename}.md`;
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        // ä½¿ç”¨æ–‡ä»¶åä½œä¸ºæ ‡é¢˜ï¼ˆå»é™¤ .md æ‰©å±•åï¼‰
                        const title = filename;
                        
                        // è·å–ä¿®æ”¹æ—¶é—´
                        const lastModified = response.headers.get('Last-Modified');
                        const modifiedTime = lastModified ? new Date(lastModified).getTime() : Date.now();
                        
                        return { filename, title, path, modifiedTime };
                    }
                } catch (error) {
                    // æ–‡ä»¶ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥
                }
                return null;
            }
            
            // åˆ›å»ºæ ‡é¢˜åˆ—è¡¨é¡¹
            function createTitleItem({ filename, title, path, modifiedTime }) {
                const titleItem = document.createElement('div');
                titleItem.className = 'title-item';
                titleItem.textContent = title;
                titleItem.setAttribute('data-path', path);
                titleItem.setAttribute('data-filename', filename);
                titleItem.setAttribute('data-modified', modifiedTime);
                
                titleItem.addEventListener('click', function() {
                    // ç§»é™¤ä¹‹å‰çš„æ¿€æ´»çŠ¶æ€
                    document.querySelectorAll('.title-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // æ·»åŠ å½“å‰æ¿€æ´»çŠ¶æ€
                    this.classList.add('active');
                    
                    // åŠ è½½ Markdown æ–‡ä»¶
                    const filePath = this.getAttribute('data-path');
                    loadMarkdown(filePath);
                });
                
                return titleItem;
            }
            
            // å¹¶è¡Œæ£€æµ‹æ‰€æœ‰æ–‡ä»¶çš„å­˜åœ¨æ€§å’Œä¿®æ”¹æ—¶é—´
            const fileChecks = await Promise.all(
                possibleFiles.map(async (filename) => {
                    const check = await checkFile(filename);
                    if (check.exists) {
                        return { filename, modifiedTime: check.modifiedTime, path: check.path };
                    }
                    return null;
                })
            );
            
            // è¿‡æ»¤å‡ºå­˜åœ¨çš„æ–‡ä»¶
            const existingFileChecks = fileChecks.filter(f => f !== null);
            
            // å¦‚æœæ²¡æœ‰ä»»ä½•æ–‡ä»¶ï¼Œæ˜¾ç¤ºæç¤º
            if (existingFileChecks.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'title-item';
                emptyMsg.textContent = 'æš‚æ— æ€è€ƒæ–‡ç« ';
                emptyMsg.style.color = '#999';
                emptyMsg.style.cursor = 'default';
                titleList.appendChild(emptyMsg);
                return;
            }
            
            // æŒ‰ä¿®æ”¹æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            existingFileChecks.sort((a, b) => b.modifiedTime - a.modifiedTime);
            
            // ä¼˜å…ˆåŠ è½½ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆæœ€æ–°ä¿®æ”¹çš„ï¼‰
            const firstFile = existingFileChecks[0];
            const firstFileInfo = await getFileInfo(firstFile.filename);
            if (firstFileInfo) {
                existingFiles.push(firstFileInfo);
                const firstItem = createTitleItem(firstFileInfo);
                firstItem.classList.add('active');
                titleList.appendChild(firstItem);
                loadMarkdown(firstFileInfo.path);
                firstFileLoaded = true;
            }
            
            // å¼‚æ­¥åŠ è½½å‰©ä½™æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯å¹¶æ·»åŠ åˆ°åˆ—è¡¨
            setTimeout(async () => {
                for (let i = 1; i < existingFileChecks.length; i++) {
                    const fileCheck = existingFileChecks[i];
                    const fileInfo = await getFileInfo(fileCheck.filename);
                    if (fileInfo) {
                        existingFiles.push(fileInfo);
                        const item = createTitleItem(fileInfo);
                        titleList.appendChild(item);
                    }
                }
                
                // é‡æ–°æ’åºæ‰€æœ‰èœå•é¡¹ï¼ˆæŒ‰ä¿®æ”¹æ—¶é—´ï¼Œæœ€æ–°çš„åœ¨å‰ï¼‰
                const items = Array.from(titleList.querySelectorAll('.title-item'));
                items.sort((a, b) => {
                    const timeA = parseInt(a.getAttribute('data-modified')) || 0;
                    const timeB = parseInt(b.getAttribute('data-modified')) || 0;
                    return timeB - timeA; // æœ€æ–°çš„åœ¨å‰
                });
                
                // ä¿å­˜å½“å‰æ¿€æ´»çš„æ–‡ä»¶è·¯å¾„
                const activeItem = titleList.querySelector('.title-item.active');
                const activePath = activeItem ? activeItem.getAttribute('data-path') : null;
                
                // æ¸…ç©ºå¹¶é‡æ–°æ·»åŠ æ’åºåçš„é¡¹ç›®
                titleList.innerHTML = '';
                items.forEach(item => {
                    titleList.appendChild(item);
                    // æ¢å¤æ¿€æ´»çŠ¶æ€
                    if (item.getAttribute('data-path') === activePath) {
                        item.classList.add('active');
                    }
                });
            }, 100);
        }
        
        function loadMarkdown(path) {
            fetch(path)
                .then(response => {
                    if (!response.ok) throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');
                    return response.text();
                })
                .then(text => {
                    document.getElementById('markdown-content').innerHTML = marked.parse(text);
                })
                .catch(error => {
                    document.getElementById('markdown-content').innerHTML = '<p>markdown æ–‡ä»¶</p>';
                });
        }
        
        generateTitleList();
    </script>
</body>
</html>

