<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¥­æ­ªæ­ª - æ€è€ƒ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <img src="images/image1.jpg" alt="å¤´åƒ" class="header-avatar">
            <h1>é¥­æ­ªæ­ª</h1>
            <span class="house-icon">ğŸ </span>
        </div>
        <nav class="header-nav">
            <a href="index.html" class="nav-item">é¦–é¡µ</a>
            <a href="log.html" class="nav-item">æ—¥å¿—</a>
            <a href="todo.html" class="nav-item">to do</a>
            <a href="growth.html" class="nav-item">æˆé•¿</a>
            <a href="thought.html" class="nav-item active">æ€è€ƒ</a>
        </nav>
    </header>

    <main class="thought-main">
        <aside class="thought-sidebar">
            <div class="title-list" id="title-list">
                <!-- æ ‡é¢˜åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </aside>
        <div class="thought-content">
            <div class="markdown-container" id="markdown-content">
            </div>
        </div>
    </main>

    <script src="js/marked.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        // æ£€æµ‹å¹¶ç”Ÿæˆæ ‡é¢˜åˆ—è¡¨ï¼ˆåªæ˜¾ç¤ºå­˜åœ¨çš„æ–‡ä»¶ï¼ŒæŒ‰ä¿®æ”¹æ—¶é—´æ’åºï¼‰
        async function generateTitleList() {
            const titleList = document.getElementById('title-list');
            const maxFiles = 100; // æœ€å¤šæ£€æµ‹100ä¸ªæ–‡ä»¶
            
            // å¿«é€Ÿæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶è·å–ä¿®æ”¹æ—¶é—´ï¼ˆä½¿ç”¨ HEAD è¯·æ±‚ï¼‰
            async function quickCheckFile(index) {
                const path = `markdown/thought/${index}.md`;
                try {
                    const response = await fetch(path, { method: 'HEAD' });
                    if (response.ok) {
                        // è·å–æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´
                        const lastModified = response.headers.get('Last-Modified');
                        const modifiedTime = lastModified ? new Date(lastModified).getTime() : Date.now();
                        return { exists: true, modifiedTime, path };
                    }
                } catch (error) {
                    // æ–‡ä»¶ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥
                }
                return { exists: false };
            }
            
            // è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ ‡é¢˜å’Œä¿®æ”¹æ—¶é—´ï¼‰
            async function getFileInfo(index) {
                const path = `markdown/thought/${index}.md`;
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        const text = await response.text();
                        // æå–ç¬¬ä¸€è¡Œä½œä¸ºæ ‡é¢˜ï¼ˆå»é™¤ # å’Œç©ºæ ¼ï¼‰
                        const firstLine = text.split('\n')[0].trim();
                        let title = firstLine.startsWith('#') 
                            ? firstLine.substring(1).trim() 
                            : firstLine;
                        // å¦‚æœæ ‡é¢˜ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤æ ‡é¢˜
                        if (!title || title.length === 0) {
                            title = `æ€è€ƒ${index}`;
                        }
                        
                        // è·å–ä¿®æ”¹æ—¶é—´
                        const lastModified = response.headers.get('Last-Modified');
                        const modifiedTime = lastModified ? new Date(lastModified).getTime() : Date.now();
                        
                        return { index, title, path, modifiedTime };
                    }
                } catch (error) {
                    // æ–‡ä»¶ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥
                }
                return null;
            }
            
            // åˆ›å»ºæ ‡é¢˜åˆ—è¡¨é¡¹
            function createTitleItem({ index, title, path, modifiedTime }) {
                const titleItem = document.createElement('div');
                titleItem.className = 'title-item';
                titleItem.textContent = title;
                titleItem.setAttribute('data-path', path);
                titleItem.setAttribute('data-index', index);
                titleItem.setAttribute('data-modified', modifiedTime);
                
                titleItem.addEventListener('click', function() {
                    // ç§»é™¤ä¹‹å‰çš„æ¿€æ´»çŠ¶æ€
                    document.querySelectorAll('.title-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // æ·»åŠ å½“å‰æ¿€æ´»çŠ¶æ€
                    this.classList.add('active');
                    
                    // åŠ è½½ Markdown æ–‡ä»¶
                    const filePath = this.getAttribute('data-path');
                    loadMarkdown(filePath);
                });
                
                return titleItem;
            }
            
            // æ£€æµ‹æ‰€æœ‰æ–‡ä»¶
            const existingFiles = [];
            
            // æ£€æµ‹å‰10ä¸ªæ–‡ä»¶
            for (let i = 1; i <= 10; i++) {
                const check = await quickCheckFile(i);
                if (check.exists) {
                    const fileInfo = await getFileInfo(i);
                    if (fileInfo) {
                        existingFiles.push(fileInfo);
                    }
                }
            }
            
            // å¦‚æœå‰10ä¸ªéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œç»§ç»­æ£€æµ‹æ›´å¤šæ–‡ä»¶
            if (existingFiles.length === 0) {
                for (let i = 11; i <= maxFiles; i++) {
                    const check = await quickCheckFile(i);
                    if (check.exists) {
                        const fileInfo = await getFileInfo(i);
                        if (fileInfo) {
                            existingFiles.push(fileInfo);
                        }
                    }
                }
            }
            
            // å¦‚æœæ²¡æœ‰ä»»ä½•æ–‡ä»¶ï¼Œæ˜¾ç¤ºæç¤º
            if (existingFiles.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'title-item';
                emptyMsg.textContent = 'æš‚æ— æ€è€ƒæ–‡ç« ';
                emptyMsg.style.color = '#999';
                emptyMsg.style.cursor = 'default';
                titleList.appendChild(emptyMsg);
                return;
            }
            
            // æŒ‰ä¿®æ”¹æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            existingFiles.sort((a, b) => b.modifiedTime - a.modifiedTime);
            
            // åˆ›å»ºå¹¶æ·»åŠ æ‰€æœ‰èœå•é¡¹ï¼ˆæŒ‰ä¿®æ”¹æ—¶é—´æ’åºï¼‰
            existingFiles.forEach((fileInfo, index) => {
                const item = createTitleItem(fileInfo);
                // ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆæœ€æ–°ä¿®æ”¹çš„ï¼‰è®¾ä¸ºæ¿€æ´»çŠ¶æ€å¹¶åŠ è½½
                if (index === 0) {
                    item.classList.add('active');
                    loadMarkdown(fileInfo.path);
                }
                titleList.appendChild(item);
            });
        }
        
        function loadMarkdown(path) {
            fetch(path)
                .then(response => {
                    if (!response.ok) throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');
                    return response.text();
                })
                .then(text => {
                    if (typeof marked !== 'undefined' && marked.parse) {
                        document.getElementById('markdown-content').innerHTML = marked.parse(text);
                    } else {
                        console.error('marked.js æœªæ­£ç¡®åŠ è½½');
                        document.getElementById('markdown-content').innerHTML = '<p>Markdown è§£æå™¨æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ js/marked.min.js æ–‡ä»¶</p>';
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½ Markdown æ–‡ä»¶å¤±è´¥:', error);
                    document.getElementById('markdown-content').innerHTML = '<p>åŠ è½½æ–‡ä»¶å¤±è´¥: ' + path + '</p>';
                });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        generateTitleList();
    </script>
</body>
</html>

